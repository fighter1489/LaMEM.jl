<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>2D Thermomechanical subduction model · LaMEM.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">LaMEM.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Installation</span><ul><li><a class="tocitem" href="../installation/">General instructions</a></li><li><a class="tocitem" href="../installation_HPC/">Installation on HPC systems</a></li></ul></li><li><span class="tocitem">Create &amp; run LaMEM models from julia</span><ul><li><a class="tocitem" href="../juliasetups/">Overview</a></li><li><a class="tocitem" href="../juliasetup_example_sphere/">Example 1: Sphere</a></li><li><a class="tocitem" href="../juliasetup_LaPalma/">Example 2: Volcano</a></li><li><a class="tocitem" href="../juliasetup_pluto/">Notebooks</a></li><li><a class="tocitem" href="../LaMEM_ModelFunctions/">Available functions</a></li></ul></li><li><a class="tocitem" href="../runlamem/">Run LaMEM</a></li><li><a class="tocitem" href="../readtimesteps/">Reading timesteps</a></li><li><a class="tocitem" href="../listfunctions/">List of functions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>2D Thermomechanical subduction model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>2D Thermomechanical subduction model</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaGeodynamics/LaMEM.jl/blob/main/docs/src/man/juliasetup_TMSubduction.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="D-Thermomechanical-subduction-model"><a class="docs-heading-anchor" href="#D-Thermomechanical-subduction-model">2D Thermomechanical subduction model</a><a id="D-Thermomechanical-subduction-model-1"></a><a class="docs-heading-anchor-permalink" href="#D-Thermomechanical-subduction-model" title="Permalink"></a></h1><p>In this example, we will show how to create a 2D thermomechanical model of subduction. Here the setup is saved into a julia script. First create <code>TM_Subduction_example.jl</code></p><h4 id=".-load-necessary-packages"><a class="docs-heading-anchor" href="#.-load-necessary-packages">1. load necessary packages</a><a id=".-load-necessary-packages-1"></a><a class="docs-heading-anchor-permalink" href="#.-load-necessary-packages" title="Permalink"></a></h4><pre><code class="nohighlight hljs">using LaMEM, GeophysicalModelGenerator, Plots</code></pre><h4 id=".-LaMEM-model-setup"><a class="docs-heading-anchor" href="#.-LaMEM-model-setup">2. LaMEM model setup</a><a id=".-LaMEM-model-setup-1"></a><a class="docs-heading-anchor-permalink" href="#.-LaMEM-model-setup" title="Permalink"></a></h4><p>The setup will include 6 differents materials with the following id&#39;s:</p><pre><code class="nohighlight hljs"># matierial id&#39;s
# 0: asthenosphere
# 1: oceanic Crust
# 2: oceanic lithosphere
# 3: continental crust
# 4: continental lithosphere
# 5: air layer</code></pre><pre><code class="nohighlight hljs">model = Model(Grid( x   = [-2000.,2000.],
                    y   = [-8.,8.],                 # &lt;- model is 2D, size in y-direction is choosen to be close to a cube shape for the cell
                    z   = [-660,40] ,
                    nel = (512,1,128)     ),

                    BoundaryConditions(temp_bot=1565, open_top_bound=1),
                    Scaling(GEO_units(temperature=1000, stress=1e9Pa, length=1km, viscosity=1e20Pa*s)),
                    Time(nstep_max=20) )  </code></pre><h5 id="Set-timestepping-parameters"><a class="docs-heading-anchor" href="#Set-timestepping-parameters">Set timestepping parameters</a><a id="Set-timestepping-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Set-timestepping-parameters" title="Permalink"></a></h5><p>Here the max time (<code>time_end</code>) is set to a large value as we limit the simulation using <code>nstep_max = 400</code></p><pre><code class="nohighlight hljs">model.Time = Time(  time_end  = 2000.0,
                    dt        = 0.01,
                    dt_min    = 0.000001,
                    dt_max    = 0.1,
                    nstep_max = 400,
                    nstep_out = 25
                 )</code></pre><h5 id="Set-solution-parameters"><a class="docs-heading-anchor" href="#Set-solution-parameters">Set solution parameters</a><a id="Set-solution-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Set-solution-parameters" title="Permalink"></a></h5><p>We activate shear heating and adiabatic heating and set the minimum and maximum viscosties of the model:</p><pre><code class="nohighlight hljs">model.SolutionParams = SolutionParams(  shear_heat_eff = 1.0,
                                        Adiabatic_Heat = 1.0,
                                        eta_min   = 5e18,
                                        eta_ref   = 1e21,
                                        eta_max   = 1e25,
                                        min_cohes = 1e3
                                    )</code></pre><h5 id="Set-surface-topography"><a class="docs-heading-anchor" href="#Set-surface-topography">Set surface topography</a><a id="Set-surface-topography-1"></a><a class="docs-heading-anchor-permalink" href="#Set-surface-topography" title="Permalink"></a></h5><p>We activate the surface topographix:</p><pre><code class="nohighlight hljs">model.FreeSurface = FreeSurface(    surf_use        = 1,                # free surface activation flag
                                    surf_corr_phase = 1,                # air phase ratio correction flag (due to surface position)
                                    surf_level      = 0.0,              # initial level
                                    surf_air_phase  = 5,                # phase ID of sticky air layer
                                    surf_max_angle  = 40.0              # maximum angle with horizon (smoothed if larger))
                                )</code></pre><h5 id="Set-model-output"><a class="docs-heading-anchor" href="#Set-model-output">Set model output</a><a id="Set-model-output-1"></a><a class="docs-heading-anchor-permalink" href="#Set-model-output" title="Permalink"></a></h5><p>We update the list of fields saved as output:</p><pre><code class="nohighlight hljs">model.Output = Output(  out_density         = 1,
                        out_j2_strain_rate  = 1,
                        out_surf            = 1, 	
                        out_surf_pvd        = 1,
                        out_surf_topography = 1,
                        out_temperature     = 1,  )</code></pre><p>Then we set adiabatic temperature throughout the model (0.4°C/km) and mantle potential temperature at the surface 1280°C:</p><pre><code class="nohighlight hljs">Tair            = 20.0;
Tmantle         = 1280.0;
Adiabat         = 0.4</code></pre><h5 id="Set-some-background-properties,-later-overwritten"><a class="docs-heading-anchor" href="#Set-some-background-properties,-later-overwritten">Set some background properties, later overwritten</a><a id="Set-some-background-properties,-later-overwritten-1"></a><a class="docs-heading-anchor-permalink" href="#Set-some-background-properties,-later-overwritten" title="Permalink"></a></h5><pre><code class="nohighlight hljs">model.Grid.Temp     .= Tmantle .+ 1.0;      # set mantle temperature (without adiabat at first)
model.Grid.Phases   .= 0;                   # Set Phases to 0 everywhere (0 is/will be asthenosphere in this setup):</code></pre><h5 id="Setup-temperature-of-the-air-to-be-20C"><a class="docs-heading-anchor" href="#Setup-temperature-of-the-air-to-be-20C">Setup temperature of the air to be 20°C</a><a id="Setup-temperature-of-the-air-to-be-20C-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-temperature-of-the-air-to-be-20C" title="Permalink"></a></h5><pre><code class="nohighlight hljs">model.Grid.Temp[model.Grid.Grid.Z .&gt; 0]    .=  Tair;
model.Grid</code></pre><h5 id="Setup-the-air-layer-(id-5)-if-Z-0.0"><a class="docs-heading-anchor" href="#Setup-the-air-layer-(id-5)-if-Z-0.0">Setup the air layer (id = 5) if Z &gt; 0.0</a><a id="Setup-the-air-layer-(id-5)-if-Z-0.0-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-the-air-layer-(id-5)-if-Z-0.0" title="Permalink"></a></h5><pre><code class="nohighlight hljs">model.Grid.Phases[model.Grid.Grid.Z .&gt; 0.0 ] .= 5;</code></pre><h5 id="Add-left-oceanic-plate"><a class="docs-heading-anchor" href="#Add-left-oceanic-plate">Add left oceanic plate</a><a id="Add-left-oceanic-plate-1"></a><a class="docs-heading-anchor-permalink" href="#Add-left-oceanic-plate" title="Permalink"></a></h5><p>Here we use the <code>AddBox!()</code> function (see <code>?GeophysicalModelGenerator.AppBox!</code> for more information). The lithosphere to asthenosphere temperature is set to 1250°C. If temperature of the plate is &gt; 1250°C then the material is turned to asthenosphere. The temperature profile of the plate is set using half space cooling and a spreading rate velocity of 0.5 cm/yr with the ridge prescribed to the &quot;left&quot; of the box.</p><pre><code class="nohighlight hljs">AddBox!(model;  xlim    = (-2000.0, 0.0), 
                ylim    = (model.Grid.coord_y[1], model.Grid.coord_y[2]), 
                zlim    = (-660.0, 0.0),
                Origin  = nothing, StrikeAngle=0, DipAngle=0,
                phase   = LithosphericPhases(Layers=[20 80], Phases=[1 2 0] ),
                T       = SpreadingRateTemp(    Tsurface    = Tair,
                                                Tmantle     = Tmantle,
                                                MORside     = &quot;left&quot;,
                                                SpreadingVel= 0.5,
                                                AgeRidge    = 0.01;
                                                maxAge      = 80.0      ) )</code></pre><h5 id="add-right-oceanic-plate"><a class="docs-heading-anchor" href="#add-right-oceanic-plate">add right oceanic plate</a><a id="add-right-oceanic-plate-1"></a><a class="docs-heading-anchor-permalink" href="#add-right-oceanic-plate" title="Permalink"></a></h5><pre><code class="nohighlight hljs">AddBox!(model;  xlim    = (1500, 2000), 
                ylim    = (model.Grid.coord_y[1], model.Grid.coord_y[2]), 
                zlim    = (-660.0, 0.0),
                Origin  = nothing, StrikeAngle=0, DipAngle=0,
                phase   = LithosphericPhases(Layers=[20 80], Phases=[1 2 0] ),
                T       = SpreadingRateTemp(    Tsurface    = Tair,
                                                Tmantle     = Tmantle,
                                                MORside     = &quot;right&quot;,
                                                SpreadingVel= 0.5,
                                                AgeRidge    = 0.01;
                                                maxAge      = 80.0      ) )</code></pre><h5 id="Add-overriding-plate-margin"><a class="docs-heading-anchor" href="#Add-overriding-plate-margin">Add overriding plate margin</a><a id="Add-overriding-plate-margin-1"></a><a class="docs-heading-anchor-permalink" href="#Add-overriding-plate-margin" title="Permalink"></a></h5><p>For the overriding plate margin the age is fixed to 90 Ma using <code>HalfspaceCoolingTemp()</code>.</p><pre><code class="nohighlight hljs">AddBox!(model;  xlim    = (0.0, 400.0), 
                ylim    = (model.Grid.coord_y[1], model.Grid.coord_y[2]), 
                zlim    = (-660.0, 0.0),
                Origin  = nothing, StrikeAngle=0, DipAngle=0,
                phase   = LithosphericPhases(Layers=[25 90], Phases=[3 4 0] ),
                T       = HalfspaceCoolingTemp(     Tsurface    = Tair,
                                                    Tmantle     = Tmantle,
                                                    Age         = 80      ) )
  ```                                                  

##### Add overriding plate craton</code></pre><p>AddBox!(model;  xlim    = (400.0, 1500.0),                  ylim    = (model.Grid.coord<em>y[1], model.Grid.coord</em>y[2]),                  zlim    = (-660.0, 0.0),                 Origin  = nothing, StrikeAngle=0, DipAngle=0,                 phase   = LithosphericPhases(Layers=[35 100], Phases=[3 4 0] ),                 T       = HalfspaceCoolingTemp(     Tsurface    = Tair,                                                     Tmantle     = Tmantle,                                                     Age         = 120      ) )</p><pre><code class="nohighlight hljs">
##### add pre-subducted slab
Here we change the dip angle of the box to 30°C to initiates subduction:</code></pre><p>AddBox!(model;  xlim    = (0.0, 300),                  ylim    = (model.Grid.coord<em>y[1], model.Grid.coord</em>y[2]),                  zlim    = (-660.0, 0.0),                 Origin  = nothing, StrikeAngle=0, DipAngle=30,                 phase   = LithosphericPhases(Layers=[30 80], Phases=[1 2 0], Tlab=1250 ),                 T       = HalfspaceCoolingTemp(     Tsurface    = Tair,                                                     Tmantle     = Tmantle,                                                     Age         = 80      ) )</p><pre><code class="nohighlight hljs">                                                    
##### Impose approximate adiabat</code></pre><p>model.Grid.Temp = model.Grid.Temp -Z.*Adiabat;</p><pre><code class="nohighlight hljs">
##### Plot preview of the setup
Cross-sections of the model setup showing the temperature and the phase fields can be visualize as follow:</code></pre><p>plot<em>cross</em>section(model, y=0, field=:temperature) plot<em>cross</em>section(model, y=0, field=:phase)</p><pre><code class="nohighlight hljs"> ![LaPalma_CrossSection](sub_field.png)
 ![LaPalma_CrossSection](sub_temp.png)


#### 3. Define material parameters
##### Softening law
Post-softening strength is defined as 0.05 the initial strength</code></pre><p>softening =       Softening(    ID   = 0,   			# softening law ID                                 APS1 = 0.1, 			# begin of softening APS                                 APS2 = 0.5, 			# end of softening APS                                 A    = 0.95, 		        # reduction ratio                             )</p><pre><code class="nohighlight hljs">
##### Material thermal and rheological properties
For the mantle we use dry olivine rheology:</code></pre><p>dryPeridotite = Phase(  Name        = &quot;dryPeridotite&quot;,                                                              ID          = 0,                                                # phase id  [-]                         rho         = 3300.0,                                           # density [kg/m3]                         alpha       = 3e-5,                                             # coeff. of thermal expansion [1/K]                         disl<em>prof   = &quot;Dry</em>Olivine<em>disl</em>creep-Hirth<em>Kohlstedt</em>2003&quot;,                         Vn          = 14.5e-6,                         diff<em>prof   = &quot;Dry</em>Olivine<em>diff</em>creep-Hirth<em>Kohlstedt</em>2003&quot;,                         Vd          = 14.5e-6,                         G           = 5e10,                                             # elastic shear module [MPa]                         k           = 3,                                                # conductivity                         Cp          = 1000.0,                                           # heat capacity                         ch          = 30e6,                                             # cohesion [MPa]                         fr          = 20.0,                                             # friction angle	                         A           = 6.6667e-12,                                       # radiogenic heat production [W/kg]                         chSoftID    = 0,      	                                        # cohesion softening law ID                         frSoftID    = 0,      	                                        # friction softening law ID                         )</p><pre><code class="nohighlight hljs">Oceanic crust:

For the oceanic crust we use a low cohesion and a frictional angle equal to 0. The goal is to make to oceanic crust weak enough to lubricate the interface with the overriding plate and allow for self-sustain subduction. Moreover, as density is not pressure and temperature dependent, it is set as the mantle to 3300 in order to be neutrally buoyant with respect to the rest of the lithosphere.</code></pre><p>oceanicCrust = Phase(   Name        = &quot;oceanCrust&quot;,                                                              ID          = 1,                                                # phase id  [-]                         rho         = 3300.0,                                           # density [kg/m3]                         alpha       = 3e-5,                                             # coeff. of thermal expansion [1/K]                         disl<em>prof   = &quot;Plagioclase</em>An75-Ranalli_1995&quot;,                         G           = 5e10,                                             # elastic shear module [MPa]                         k           = 3,                                                # conductivity                         Cp          = 1000.0,                                           # heat capacity                         ch          = 5e6,                                              # cohesion [MPa]                         fr          = 0.0,                                              # friction angle	                         A           = 2.333e-10,                                        # radiogenic heat production [W/kg]                      )</p><pre><code class="nohighlight hljs">Oceanic lithosphere:</code></pre><p>oceanicLithosphere = copy_phase(    dryPeridotite,                                     Name            = &quot;oceanicLithosphere&quot;,                                     ID              = 2                                 )</p><pre><code class="nohighlight hljs">Contiental crust:</code></pre><p>continentalCrust = copy<em>phase(      oceanicCrust,                                     Name            = &quot;continentalCrust&quot;,                                     ID              = 3,                                     disl</em>prof       = &quot;Quarzite-Ranalli_1995&quot;,                                     rho             = 2700.0,                                       ch              = 30e6,                                     fr              = 20.0,                                     A         	    = 5.3571e-10,                                     chSoftID  	    = 0,      	                                                                             frSoftID  	    = 0,      	                                                                      )</p><pre><code class="nohighlight hljs">Continental lithosphere:</code></pre><p>continentalLithosphere = copy_phase(    dryPeridotite,                                         Name            = &quot;continentalLithosphere&quot;,                                         ID              = 4                                 )</p><pre><code class="nohighlight hljs">                                </code></pre><p>air         = Phase(    Name        = &quot;air&quot;,                                                              ID          = 5,                                                # phase id  [-]                         rho         = 50.0,                                             # density [kg/m3]                                           # coeff. of thermal expansion [1/K]                         eta         = 1e19,                         G           = 5e10,                                             # elastic shear module [MPa]                         k           = 100,                                              # conductivity                         Cp          = 1e6,                                              # heat capacity                         ch          = 10e6,                                             # cohesion [MPa]                         fr          = 0.0,                                              # friction angle	                     )</p><pre><code class="nohighlight hljs">
##### Add phases to the model</code></pre><p>rm<em>phase!(model) add</em>phase!( model,              dryPeridotite,             oceanicCrust,             oceanicLithosphere,             continentalCrust,             continentalLithosphere,             air           )</p><pre><code class="nohighlight hljs">
##### Add softening law</code></pre><p>add_softening!( model,                 softening                 )</p><pre><code class="nohighlight hljs">

##### Set solver options
The PETSc command ```-da_refine_y 1``` allow to run the model as 2D</code></pre><p>model.Solver = Solver(  SolverType     = &quot;direct&quot;,                          DirectSolver 	= &quot;superlu<em>dist&quot;,                          DirectPenalty 	= 1e5,                          PETSc</em>options  = [ &quot;-snes<em>ksp</em>ew&quot;,                                              &quot;-da<em>refine</em>y 1&quot; ]                      )</p><pre><code class="nohighlight hljs">
#### 4. Perform simulation
Here we indicate 4 cores, use 8 if possible!</code></pre><p>run_lamem(model, 4) ```</p><p><img src="../subduction_ts25.png" alt="LaPalma_CrossSection"/></p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Tuesday 17 October 2023 13:51">Tuesday 17 October 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
